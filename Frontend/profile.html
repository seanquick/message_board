<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Profile</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container narrow pad">
    <h1 id="userName">Profile</h1>

    <div id="profileBox" class="profile-box">
      <img id="profilePhoto" class="profile-photo" src="" alt="User Photo" hidden />

      <div class="profile-info">
        <p id="userBio" class="profile-bio" hidden></p>

        <div id="userQuotesBox" class="profile-quotes" hidden>
          <h3>Favorite Quotes</h3>
          <ul id="userQuotesList"></ul>
        </div>
      </div>
    </div>

    <p id="errorMsg" class="error" hidden></p>
  </main>

  <script type="module">
    import { api } from './_utils.js'; // use your existing api wrapper if available

    const q = sel => document.querySelector(sel);
    const params = new URLSearchParams(location.search);
    const userId = params.get('id');

    async function loadProfile() {
      if (!userId) {
        q('#errorMsg').textContent = 'Missing user ID.';
        q('#errorMsg').hidden = false;
        return;
      }

      try {
        const profile = await api(`/api/profile/${userId}`);

        q('#userName').textContent = profile.name || 'Unnamed User';

        if (profile.bio) {
          q('#userBio').textContent = profile.bio;
          q('#userBio').hidden = false;
        }

        if (profile.photoUrl) {
          const img = q('#profilePhoto');
          img.src = profile.photoUrl;
          img.alt = `${profile.name || 'User'}'s photo`;
          img.hidden = false;
        }

        if (Array.isArray(profile.favoriteQuotes) && profile.favoriteQuotes.length > 0) {
          const list = q('#userQuotesList');
          list.innerHTML = '';
          profile.favoriteQuotes.forEach(qt => {
            const li = document.createElement('li');
            li.textContent = qt;
            list.appendChild(li);
          });
          q('#userQuotesBox').hidden = false;
        }

      } catch (err) {
        console.error('Error loading profile:', err);
        q('#errorMsg').textContent = err?.error || 'Failed to load profile';
        q('#errorMsg').hidden = false;
      }
    }

    loadProfile();
  </script>
</body>
</html>
