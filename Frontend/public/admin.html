<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .grid { display:grid; gap:1rem; }
    .grid.cols-4 { grid-template-columns: repeat(4, minmax(0,1fr)); }
    .stat { padding:1rem; border-radius:8px; background:#f7f7fb; border:1px solid #eee; }
    .stat .v { font-size:1.6rem; font-weight:800; margin-top:.25rem; }
    .toolbar { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .pill { padding:.15rem .45rem; border-radius:999px; font-size:.8rem; background:#eef; color:#334; display:inline-block; }
    .activeRow { outline: 2px solid #8ab4f8; outline-offset: -2px; }
    .empty { color:#6b7280; text-align:center; padding:.75rem }

    /* âœ… Modal styling */
    #adminReportModal .report-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #adminReportModal .report-dialog {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      overflow: auto;
    }
    #adminReportModal .report-dialog header {
      margin-bottom: 1rem;
    }
    #adminReportModal .report-dialog section {
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

<main class="container">
  <h1 class="row between">Admin Dashboard
    <span id="notifBell" class="row items-center" style="gap:.35rem">
      <span class="pill" id="notifCount" style="display:none">0</span>
    </span>
  </h1>
  <div id="adminErr" class="err mt-1" aria-live="polite"></div>

  <!-- Metrics -->
  <section class="grid cols-4 mt-2">
    <div class="stat"><div>Total Users</div><div id="mUsers" class="v">â€”</div></div>
    <div class="stat"><div>Total Threads</div><div id="mThreads" class="v">â€”</div></div>
    <div class="stat"><div>Total Comments</div><div id="mComments" class="v">â€”</div></div>
    <div class="stat"><div>Open Reports</div><div id="mReports" class="v">â€”</div></div>
  </section>

  <!-- Global Search -->
  <section class="card mt-2">
    <div class="toolbar between">
      <h2 class="minw-0">Global Search</h2>
      <div class="row items-center" style="gap:.5rem; flex-wrap:wrap">
        <input id="sQ" placeholder="Search textâ€¦" style="min-width:220px" />
        <select id="sType">
          <option value="all">All</option>
          <option value="threads">Threads</option>
          <option value="comments">Comments</option>
          <option value="users">Users</option>
          <option value="reports">Reports</option>
        </select>
        <select id="sStatus">
          <option value="">Any status</option>
          <option value="active">Active</option>
          <option value="deleted">Deleted</option>
          <option value="pinned">Pinned (threads)</option>
          <option value="locked">Locked (threads)</option>
          <option value="open">Open (reports)</option>
          <option value="resolved">Resolved (reports)</option>
        </select>
        <input type="date" id="sFrom" />
        <input type="date" id="sTo" />
        <input id="sMinUp" type="number" min="0" step="1" placeholder="Min upvotes" style="width:110px" />
        <input id="sCategory" placeholder="Category (reports)" style="width:160px" />
        <button id="sGo" class="btn tiny">Search</button>
        <button id="sReset" class="btn tiny">Reset</button>
      </div>
    </div>
    <div class="overflow-auto mt-1">
      <table id="searchTable">
        <thead>
          <tr>
            <th>When</th>
            <th>Type</th>
            <th>Title / Snippet</th>
            <th>Author / Status</th>
            <th>Upvotes</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody><tr><td colspan="6" class="empty">Enter a query and press Search.</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- Reports -->
  <section class="card mt-2">
    <div class="toolbar between">
      <h2 class="minw-0">Reports Queue</h2>
      <div class="row items-center gap-05">
        <label class="row items-center gap-05"><input type="checkbox" id="rGroup" /> <span>Group similar</span></label>
        <select id="rFilter">
          <option value="open">Open</option>
          <option value="resolved">Resolved</option>
          <option value="all">All</option>
        </select>
        <button id="rBulkResolve" class="btn tiny">Resolve selected</button>
        <button id="rExport" class="btn tiny">Export CSV</button>
        <button id="rRefresh" class="btn tiny">Refresh</button>
        <label class="row items-center" style="gap:.35rem"><input type="checkbox" id="rSelectAll" /> <span>Select all</span></label>
      </div>
    </div>
    <div class="overflow-auto mt-1">
      <table id="reportsTable">
        <thead>
          <tr>
            <th></th>
            <th>When</th>
            <th>Type</th>
            <th>Snippet</th>
            <th>Reason</th>
            <th>Reporter</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Export Section -->
  <section id="export-section" class="card mt-2">
    <h2>Export / Backup</h2>
    <div id="export-container"></div>
  </section>

  <!-- Threads -->
  <section class="card mt-2">
    <div class="toolbar between">
      <h2 class="minw-0">Threads</h2>
      <div class="row items-center gap-05">
        <label class="row items-center gap-05"><input id="tIncludeDeleted" type="checkbox" /><span>Show deleted</span></label>
        <button id="tRefresh" class="btn tiny">Refresh</button>
      </div>
    </div>
    <div class="overflow-auto mt-1">
      <table id="threadsTable">
        <thead>
          <tr>
            <th>Created</th>
            <th>Title</th>
            <th>Author</th>
            <th>Upvotes</th>
            <th>Comments</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Comments -->
  <section class="card mt-2">
    <div class="toolbar between">
      <h2 class="minw-0">Recent Comments</h2>
      <div class="row items-center gap-05">
        <label class="row items-center gap-05"><input id="cIncludeDeleted" type="checkbox" /><span>Show deleted</span></label>
        <select id="cPageSize">
          <option value="25">25</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
        </select>
        <span id="cPageInfo" class="meta">â€”</span>
        <button id="cPrev" class="btn tiny">Prev</button>
        <button id="cNext" class="btn tiny">Next</button>
        <button id="cExport" class="btn tiny">Export CSV</button>
        <button id="cRefresh" class="btn tiny">Refresh</button>
      </div>
    </div>
    <div class="overflow-auto mt-1">
      <table id="commentsTable">
        <thead>
          <tr>
            <th>When</th>
            <th>Snippet</th>
            <th>Author</th>
            <th>Thread</th>
            <th>Upvotes</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Users -->
  <section class="card mt-2">
    <div class="toolbar between">
      <h2 class="minw-0">Users</h2>
      <div class="row items-center gap-05">
        <input id="uSearch" placeholder="Search name or emailâ€¦" />
        <select id="uPageSize">
          <option value="25">25</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
        </select>
        <span id="uPageInfo" class="meta">â€”</span>
        <button id="uPrev" class="btn tiny">Prev</button>
        <button id="uNext" class="btn tiny">Next</button>
        <button id="uExport" class="btn tiny">Export CSV</button>
        <button id="uRefresh" class="btn tiny">Search</button>
      </div>
    </div>
    <div class="overflow-auto mt-1">
      <table id="usersTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Role</th>
            <th>Status</th>
            <th>Joined</th>
            <th>Notes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<!-- âœ… Modal for viewing report details -->
<div id="adminReportModal">
  <div class="report-backdrop">
    <div class="report-dialog">
      <header><h3>Report Detail</h3></header>
      <section id="reportDetailBody"></section>
      <div style="text-align: right; margin-top: 1rem;">
        <button id="adminReportClose" class="btn tiny">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ðŸ§  Shared base logic must load first -->
<script type="module" src="nav.js"></script>
<script type="module" src="main.js"></script>

<!-- ðŸ“Œ Functional logic (uses main.js helpers) -->
<script type="module" src="threads.js"></script>
<script type="module" src="account.js"></script>
<script type="module" src="admin.js"></script>

<!-- ðŸ§ª Admin extensions -->
<script type="module" src="/adminExport.js"></script>
<script type="module" src="/adminTest.js"></script>

</body>
</html>
